#!/bin/bash

# Lyra Profiler Script - Safe Mode Training Profiler
# Usage: lyra-profile TRAINING_SCRIPT ENV_PATH

TRAINING_SCRIPT="$1"
ENV_PATH="$2"

# Template prompt for Claude Code
PROMPT="Modify the training code $TRAINING_SCRIPT to:\
  1) put it in safe mode, where model saving is disabled and no permanent data rewriting/modification
   occurs\
  2) the training is limited to 100 steps\
  3) The pytorch advanced profiler is added to the training loop.\
  Execute this training loop with the environment $ENV_PATH and save the outputs to the
   file lyra-profile.txt in the same directory as the training file.
  Restore the original training script when completed."


# Display progress information
echo "ðŸŽ¼ Lyra Safe Mode Profiler Starting..."
echo "   This orchestration may take 3-10 minutes depending on training complexity..."
echo "   Environment setup, profiling execution, and cleanup will be performed safely."
echo ""

# Run Claude Code with the prompt (auto-accept edits to avoid interactive prompts)
claude --permission-mode acceptEdits "$PROMPT"

# Display completion message
echo ""
echo "ðŸŽ¼âœ¨ Safe profiling symphony complete! Your performance insights have been harmoniously generated."