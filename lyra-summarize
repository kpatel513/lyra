#!/bin/bash

# Lyra Repository Analysis Script
# Usage: lyra-summarize REPO_PATH

if [ $# -eq 0 ]; then
    echo "Usage: lyra-summarize REPO_PATH"
    exit 1
fi

REPO_PATH="$1"

if [ ! -d "$REPO_PATH" ]; then
    echo "Error: Directory $REPO_PATH does not exist"
    exit 1
fi

# Template prompt for Claude Code
PROMPT="Please analyze the repository at $REPO_PATH and generate a report summary covering:

1. **Mixed Precision Training**: Search the codebase for evidence of mixed precision training usage, including:
   - Automatic Mixed Precision (AMP) implementations
   - FP16/BF16 data types
   - GradScaler usage
   - Mixed precision configuration files
   - Training scripts with precision settings

2. **Sharding**: Search for distributed training and model/data sharding implementations, including:
   - Data parallel training setups
   - Model parallelism configurations
   - Tensor sharding strategies
   - Distributed training frameworks (DeepSpeed, FairScale, etc.)
   - Pipeline parallelism implementations

For each finding, please provide:
- File locations with line numbers
- Brief code snippets showing the implementation
- Configuration details if available
- Framework/library used (PyTorch, TensorFlow, JAX, etc.)

Generate a concise report with clear YES/NO answers for both categories, followed by supporting evidence and implementation details."

# Run Claude Code with the prompt
cd "$REPO_PATH" && claude --message "$PROMPT"